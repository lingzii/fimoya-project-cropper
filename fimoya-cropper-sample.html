<!DOCTYPE html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <script src="js/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="css/cropper.css" />
    <script src="js/cropper.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="css/chiachi_css.css" />
    <link rel="shortcut icon" href="img/title.gif" />
    <script src="js/fontawesome.js"></script>
    <title>公主連結</title>
    <style type="text/css">
      .preview {
        height: 9rem;
        width: 16rem;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="work_index.html">
        <img src="img/LOGO.jpg" class="button_style" />
      </a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbar_drop_down"
        aria-controls="navbar_drop_down"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbar_drop_down">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="work_index.html">首頁</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="page2.html">抽抽</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="page3.html">油油紅包</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="page4.html">協助截圖</a>
          </li>
        </ul>
        <span class="navbar-text"> 我不是宅宅...真的不是!! </span>
      </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <div class="col-2">button</div>
            <div class="col-6 box">
                <div>
                    <img
                    id="imgd"
                    style="display: block; max-width: 100%"
                    src="img/head/1.jpg"
                    alt="Picture"
                    />
                </div>
            </div>
            <div class="col-3" style="flex-direction: column;">
                <div style="width: 100%; height: inherit">preview</div>
                <div style="width: 100%; height: 100%;">result</div>
            </div>
        </div>
    </div>
    <!-- <div class="container mt-5">
      <div class="row">
        <div class="col-6 box">
          <div>
            <img
              id="imgd"
              style="display: block; max-width: 100%"
              src="img/head/1.jpg"
              alt="Picture"
            />
          </div>
        </div>
        <div class="col-6">
          <div class="preview" style="overflow: hidden"></div>
        </div>
      </div> -->
      <!-- <div>
        <label class="btn btn-info"
          ><input
            id="upload_img"
            style="display: none"
            class="btn btn-info"
            type="file"
            accept="image/*"
          /><i class="fa fa-photo"></i> 上傳圖片</label
        >
        <label class="btn btn-info"
          ><input id="crop_img" style="display: none" /><i
            class="fa fa-scissors"
          ></i>
          裁剪圖片</label
        >
      </div> -->
    </div>
    <!-- <div id="result"></div> -->
  </body>
  <script type="text/javascript">
    function canvasCrop(source) {
      var canvas = document.createElement("canvas");
      var context = canvas.getContext("2d");
      var width = source.width;
      var height = source.height;
      canvas.width = width;
      canvas.height = height;
      context.imageSmoothingEnabled = true;
      //圖像平滑度開啟
      context.drawImage(source, 0, 0, width, height);
      //drawImage(img,dx,dy,dwidth,dheight)
      context.globalCompositeOperation = "destination-in";
      // globalCompositeOperation含12種合成設定，每一種合成設定均將套用到新繪製的圖形上
      //destination-in只保留新、舊圖形重疊的舊圖形區域，其餘皆變為透明。
      context.beginPath();
      context.rect(0, 0, width, height);
      context.fill();
      //填充填滿
      return canvas;
    }
    var image = document.getElementById("imgd");
    var button = document.getElementById("crop_img");
    var result = document.getElementById("result");
    var croppable = false;
    var cropper = new Cropper(image, {
      aspectRatio: NaN,
      //比例
      viewMode: 1,
      //裁剪空間可以到外面
      preview: ".preview",
      //預覽圖
      ratotable: true,
      //可旋轉但我沒做
      crop(event) {
        croppable = true;
        //當正在拉圖的時候表示true(框在上面的時候)
      },
    });
    button.onclick = function () {
      var croppedCanvas;
      var roundedCanvas;
      var roundedImage;
      if (!croppable) {
        return;
      }
      var image = document.getElementById("imgd");
      var button = document.getElementById("crop_img");
      var result = document.getElementById("result");
      var croppable = false;
      var cropper = new Cropper(image, {
        aspectRatio: NaN,
        //比例
        viewMode: 0,
        //裁剪空間可以到外面
        preview: ".preview",
        //預覽圖
        ratotable: true,
        //可旋轉但我沒做
        crop(event) {
          croppable = true;
          //當正在拉圖的時候表示true(框在上面的時候)
        },
      });
      button.onclick = function () {
        if (!croppable) {
          return;
        }
        // Crop
        var croppedCanvas = cropper.getCroppedCanvas();
        //返回影象裁剪後，繪製的canvas物件，如果影象未裁剪，則將返回整個影象，繪製的canvas。
        // Round
        var roundedCanvas = canvasCrop(croppedCanvas);
        //繪製canvas。
        // Show
        var roundedImage = document.createElement("img");
        roundedImage.src = roundedCanvas.toDataURL();
        //roundedCanvas轉成圖片+base64模式 (toDataURL)
        result.innerHTML = "";
        //清空HTML讓他不會重複生成
        result.appendChild(roundedImage);
        //生成圖片在result 用生成appendChild子節點的方式
      };
    };
  </script>
</html>
